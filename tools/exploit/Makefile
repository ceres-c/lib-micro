CC = gcc
CFLAGS = -Wl,-rpath . -O0 -fPIE -Wno-unused-function -Wno-unused-variable -ggdb -Wall -masm=intel
STATIC_CFLAGS = -static -Wl,-R . -O0 -fPIE -Wno-unused-function -Wno-unused-variable -ggdb -Wall -masm=intel
TARGET = exploit
TARGET_STATIC = $(TARGET)_static

ARCHIVE_FILE =  $(wildcard $(BUILD_DIR)/*.a)

CFLAGS_STATIC = -static -O0 -fPIE -Wno-unused-function -Wno-unused-variable -ggdb -Wall -masm=intel -I $(INCLUDE_DIR)

LIBS = -l $(LIBARY_PATH)

SOURCES = $(wildcard *.c)
HEADERS = $(wildcard *.h) $(wildcard ucode/*.h)

$(TARGET_STATIC): $(SOURCES) $(HEADERS)
	$(CC) $(STATIC_CFLAGS) -I $(INCLUDE_DIR) $(SOURCES) $(ARCHIVE_FILE) -o $@

$(TARGET): $(SOURCES) $(HEADERS)
	$(CC) $(CFLAGS) -I $(INCLUDE_DIR) -L $(BUILD_DIR) $(SOURCES) -lmicro -o $@

all: $(TARGET_STATIC) $(TARGET)

clean:
	rm -f $(TARGET_STATIC) $(TARGET)

.PHONY: all clean
.DEFAULT_GOAL := all
